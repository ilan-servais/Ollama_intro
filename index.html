<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Chat Ollama Local</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    textarea { width: 100%; height: 100px; }
    button { margin-top: 10px; padding: 10px 20px; font-size: 16px; }
    #response { white-space: pre-wrap; background: #f2f2f2; padding: 15px; margin-top: 20px; border-radius: 6px; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h1>💬 Chat avec Ollama (llama3)</h1>

  <textarea id="prompt" placeholder="Écris ton message ici..."></textarea><br>
  <button onclick="ask()">Envoyer</button>

  <div id="response">🧠 Réponse ici...</div>

    <script>
    async function ask() {
        const prompt = document.getElementById('prompt').value;
        const responseDiv = document.getElementById('response');
        responseDiv.textContent = "⏳ En attente de la réponse...";

        const res = await fetch('http://localhost:11434/api/generate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ model: 'llama3.2:latest', prompt: prompt })
        });

        const reader = res.body.getReader();
        const decoder = new TextDecoder();
        let fullResponse = '';

        while (true) {
        const { done, value } = await reader.read();
        if (done) break;
        const chunk = decoder.decode(value, { stream: true });
        
        // chaque ligne est un JSON contenant "response"
        chunk.trim().split('\n').forEach(line => {
            try {
            const json = JSON.parse(line);
            if (json.response) {
                fullResponse += json.response;
                responseDiv.textContent = fullResponse;
            }
            } catch (e) {
            // Ignorer les erreurs JSON partielles
            }
        });
        }
    }
    </script>
</body>
</html>
